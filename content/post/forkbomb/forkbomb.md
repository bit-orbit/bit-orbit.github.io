---
title: "فورک بمب چیست و چطور کار می‌کند؟"
date: 2023-12-27T16:39:27+03:30
draft: false
image: '/images/post/fork_bomb.jpg'
descrioption: 'dsf'
categories: [
    'linux',
]
tags: [
    'فورک بومب چیست',
    'forkbomb چیست',
    ':(){ :|:& };:',
    'ریکرشن بینهایت',
    'infinite recursion',
    'recursion',
]
---

اوایل که لینوکس نصب کرده بودم کامند هایی که توی 
فروم های مختلف می‌دیدم و برای من جدید بود
را دوست داشتم یاد بگیرم و بدونم
کارشون چی هست، برای همین هر کامندی را که می‌دیدم در اولین
فرصت داخل سیستم خودم اجرا می‌کردم. که خب کور کورانه اجرای
هر کامندی اشتباهه بود. یکی از این کامند ها که اجرا کرده
بودم، به اسم فورک بمب
(fork bomb)
شناخته می‌شود. کامند به این صورت هست

```bash
:(){ :|:& };:
```

اگر این کامند را اجرا کنید(امیدوارم تا الان نکرده باشید) تقریبا زیر یک دقیقه سیستم شما
هنگ می‌کنه و مجبور می‌شوید ری‌استارت‌ش کنید.

---

توی این پست من ساختار این کامند را تشریح می‌کنم و باهم 
کمی
bash
یاد می‌گیریم.

بیایید اول با مفهوم
recustion
آشنا بشیم، زمانی که یک قطعه کد خودش اجرا کند،
recusion
می‌گویم. مثلا شما یک فانکشن می‌نویسید به اسم
*fn*
و توی بدنه فانکشن فقط خود همین فانکشن را صدا می‌‌کنید،
به این کار
call recursion
گفته می‌شود. فورک بمب دقیقا همین کار را می‌کند. به این 
معنی که خودش را دائم اجرا می‌کند!

به این فکر کنید که وقتی یک پراسس خودش را اجرا می‌کند 
،مجدد پراسس های اجرا شده توسط اون هم دائم خودشان را اجرا 
می‌کنند، 
و دوباره هر پروسه‌ای که اجرا می‌شود بازم خودش را اجرا 
می‌کند و این روند تا زمانی که رم و پردازنده سیستم تحمل 
داشته باشد ادامه دارد.

> درختی که می‌بینید را اجرای فورک بمب درنظر بگیرید،
هر ستاره یک پروسه جدید است که توسط پروسه قبلی اجرا شده،
و خودش هم دائم پروسه جدید باز می‌کند و هر یک از پروسه ها 
هم همین راند را ادامه می‌دهند.

```rust
*
├── *
│   ├── *
│   │   └── *
│   │       ├── *
│   │       │   ├── *
│   │       │   └── *
│   │       ├── *
│   │       │   ├── *
│   │       │   └── *
│   │       └── *
│   │           ├── *
│   │           └── *
│   └── *
│       └── *
│           ├── *
│           │   ├── *
│           │   └── *
│           ├── *
│           │   ├── *
│           │   └── *
│           └── *
│               ├── *
│               └── *
│    
├── *
│   └── *
│       ├── *
│       ├── *
│       │   └── *
│       ├── *
│       │   ├── *
│       │   └── *
│       └── *
│           ├── *
│           └── *
├── *
│   └── *
│       ├── *
│       │   ├── *
│       │   └── *
│       ├── *
│       │   ├── *
│       │   └── *
│       └── *
│           ├── *
│           └── *

```


من برای اینکه سیستم‌م هنگ نکند فورک بمب را روی داکر
اجرا کردم و خب حتی یک ثانیه هم طول نکشید و آن کانتینر
کاملا هنگ کرد.

> قبل از اجرا
[![forkbomb on docker](/images/post/forkbomb_docker0.jpg)](/images/post/forkbomb_docker0.jpg)

> زمان اجرا
[![forkbomb on docker](/images/post/forkbomb_docker.jpg)](/images/post/forkbomb_docker.jpg)

---

بیایید وارد کد بشیم، این علامت ها و کاراکتر ها چی هستند؟

برای تعریف یک فانکشن توی 
bash
ما به این صورت عمل می‌کنیم که اول اسم فانکشن بعد پرانتر 
و بعد کرلی براکت(توی فارسی می‌گیم آکولاد) و داخل کرلی 
براکت ما قطعه کد را می‌نویسیم. مثلا برای فانکشنی که یک
اسم را روی صفحه چاپ کنه به این صورت عمل می‌کنیم

```bash
pname(){ echo 'foo'; }
```

حالا اگه دقت کنید اولین کاراکتر فورک بمب، علامت
`:`
است. این علامت اسم فانکشن ما است. برخلاف قانون تعریف نام 
متغییر ها توی
bash،
می‌توانیم از کاراتر های یونیکد هم برای تعریف نام فانکشن 
استفاده کنیم، مثلا یک
کاراکتر چینی یا حتی ایموجی!

```bash
雨(){ echo 'rain'; }

❤️(){ echo 'love'; }
```

خب در ادامه علامت های
`()`
را می‌بینیم، توی
bash
برای تعریف فانکشن قبل از اسم فانکشن هیچ کلمه کلیدی مثل
fn, def, void
و ... نیاز نیست، فقط بجای آن باید
**بعد از اسم فانکشن**
پرانتز ها را بگذارید.

مثل خیلی از زبان های برنامه نویسی، بدنه فانکشن توی
کرلی براکت تعریف می‌شود.

```bash
:(){}
```
پس تا اینجا ما یک فانکشن ساده با نام
`:`
تعریف کردیم.

داخل بدنه این فانکشن، اسمی که برای فانکشن قرار دادیم
همان
`:`
را می‌نویسیم. با اینکار دقیقا
call recursion
را انجام دادیم، و باعث شدیم که برنامه خودش را
توی هر اجرا مجدد اجرا کند.

```bash
:(){ : }
```

> دقت کنید توی سینتکس
> bash
> حتما باید یک فاصله برای کدی که داخلی کرلی براکت می‌نویسم قرار بدیم

علامت
`|`
به اسم پایپ شناخته می‌شود، وظیفه این علامت
دادن خروجی یک کامند بعنوان ورودی به یک کامند دیگر هست، 
حلا اگر
دقت کنید ما ریزالت اجرای
`:`
را به خودش می‌دهیم. دقیقا به این شکل

```bash
:(){ :|: }
```
با این علامت هر پروسه دو بار پروسه جدیدی از خودش می‌سازد
اگر از این علامت استفاده نکنیم، پروسه ما به صورت خطی خودش
را اجرا خواهد کرد، اینطوری کد ما با یک عادی
`while`
تفاوتی نخواهد داشت.


علامت
`&`
اجرای یک کامند را به بکگراند(پس زمینه) می‌برد.
برای مثال اگر یک برنامه اجرا کنید و تا تمام شدن اجرای
آن برنامه نتوانید از ترمینال استفاده کنید، شما می‌توانید
آن برنامه را در بکگراند اجرا کنید. حالا توی فورک بمب
این علامت باعث می‌شه تا یک کد درحالی که کارش به اتمام
نرسیده است، کامند بعدی اجرا بشود.

![& in bash](/images/post/forkbomb_and.jpg)

و بعد علامت
`;`
را می‌بینیم. این علامت کامند ها را از هم جدا می‌کند.
مثلا شما می‌توانید چند کامند مختلف را توی یک خط بنویسید.
توی فورک بمب این علامت فانکشنی که تعریف کردین را از
دستور بعدی(که اجرا کننده اون فانکشن هست)جدا می‌کند.

```bash
echo 'foo'; echo 'bar'; echo 'baz';
```

آخرین علامتی که توی فورک بمب داریم همون علامت
`:`
یا همون اسمی هست که برای فانکشن قرار دادیم.
خیلی ساده توی
bash
برای اجرای یک فانکشن فقط اسم‌ش را می‌نویسیم.



و تمام! ما یاد گرفتیم چطور فورک بمب رو بنویسیم و دیگه
نیاز نیست حفظ‌ش کنیم :)

```bash
:(){ :|:& };:
```